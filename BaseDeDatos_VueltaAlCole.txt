CREATE DATABASE IF NOT EXISTS sistema_publicaciones;
USE sistema_publicaciones;

CREATE TABLE usuarios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL,
    apellido VARCHAR(50) NOT NULL,
    mail VARCHAR(100) NOT NULL UNIQUE,
    contrase√±a VARCHAR(255) NOT NULL,
    dni VARCHAR(15) UNIQUE,
    fecha_registro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    genero ENUM('Masculino', 'Femenino', 'Otro') DEFAULT 'Otro',
    fecha_nacimiento DATE,
    telefono VARCHAR(20)
);

CREATE TABLE colegio (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    direccion VARCHAR(255),
    logo VARCHAR(255)
);

CREATE TABLE curso (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    id_colegio INT NOT NULL,
    FOREIGN KEY (id_colegio) REFERENCES colegio(id)
        ON UPDATE CASCADE
        ON DELETE CASCADE
);

CREATE TABLE categoria (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL
);

CREATE TABLE publicacion (
    id INT AUTO_INCREMENT PRIMARY KEY,
    titulo VARCHAR(150) NOT NULL,
    descripcion TEXT,
    fecha_publicacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    precio DECIMAL(10,2),
    estado ENUM('Activo', 'Inactivo', 'Pausado') DEFAULT 'Activo',
    descuento DECIMAL(5,2) DEFAULT 0,
    imagenes VARCHAR(255),
    id_categoria INT,
    FOREIGN KEY (id_categoria) REFERENCES categoria(id)
        ON UPDATE CASCADE
        ON DELETE SET NULL
);

CREATE TABLE publicacion_colegio (
    id_publicacion INT,
    id_colegio INT,
    PRIMARY KEY (id_publicacion, id_colegio),
    FOREIGN KEY (id_publicacion) REFERENCES publicacion(id)
        ON UPDATE CASCADE
        ON DELETE CASCADE,
    FOREIGN KEY (id_colegio) REFERENCES colegio(id)
        ON UPDATE CASCADE
        ON DELETE CASCADE
);

CREATE TABLE publicacion_curso (
    id_publicacion INT,
    id_curso INT,
    PRIMARY KEY (id_publicacion, id_curso),
    FOREIGN KEY (id_publicacion) REFERENCES publicacion(id)
        ON UPDATE CASCADE
        ON DELETE CASCADE,
    FOREIGN KEY (id_curso) REFERENCES curso(id)
        ON UPDATE CASCADE
        ON DELETE CASCADE
);

CREATE TABLE favoritos (
    id_usuario INT,
    id_publicacion INT,
    PRIMARY KEY (id_usuario, id_publicacion),
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id)
        ON UPDATE CASCADE
        ON DELETE CASCADE,
    FOREIGN KEY (id_publicacion) REFERENCES publicacion(id)
        ON UPDATE CASCADE
        ON DELETE CASCADE
);



